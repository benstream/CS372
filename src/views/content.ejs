<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<link href="/css/style.css" rel="stylesheet" >
	<title>Video Player</title>
</head>

<style>
	mark {
		background-color: yellow;
		color: black;
	}

	table,
	th,
	td {
		border: 1px solid;
	}
</style>

<script>
	var media_id = '<%=movie.video%>';

	function setMediaValue(event) {
		var updated_media_id = document.getElementById('watch').value;
		alert('Updated YouTube Video ID: ' + updated_media_id);
		event.preventDefault();
	}

	// This code loads the IFrame Player API code asynchronously.
	var tag = document.createElement('script');

	tag.src = 'https://www.youtube.com/iframe_api';
	var firstScriptTag = document.getElementsByTagName('script')[0];
	firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

	// This function creates an <iframe> after the API code downloads.
	var player;
	function onYouTubeIframeAPIReady() {
		player = new YT.Player('player', {
			height: '390',
			width: '640',
			videoId: media_id,
			playerVars: {
				playsinline: 1
			},
			events: {
				onReady: onPlayerReady,
				onStateChange: onPlayerStateChange
			}
		});
	}

	// The API will call this function when the video player is ready.
	function onPlayerReady(event) {
		event.target.playVideo();
	}

	// The API calls this function when the player's state changes.
	// The function indicates that when playing a video (state=1),
	// the player should play for six seconds and then stop.
	var done = false;
	function onPlayerStateChange(event) {
		if (event.data == YT.PlayerState.PLAYING && !done) {
			setTimeout(stopVideo, 6000);
			done = true;
		}
	}
	function stopVideo() {
		player.stopVideo();
	}

</script>

<body>
	<h1>
		<%= movie.title %> üé¨
	</h1>

	<div id="navigation"><a href="/success">Home</a> ‚Äî <a href="/">Logout</a></div>

	<br />

	<div class="video-player">
		<div class="viewer-choice">
			<% if (movie.choice) { %>
				<mark>Viewer's Choice</mark>

				<br />
				<% } %>
		</div>

		<div class="rating">
			<div>
				<div id="player"></div>

				<br />

				<br />

				<!-- TODO: Keep track of the number of thumbs up and down. -->
				<!-- movie.likes and movie.dislikes -->
				<div class="thumbs">
					<button class="thumbs_up">üëç</button>
					<button class="thumbs_down">üëé</button>
				</div>

				<br />

				<table>
					<tr>
						<th>Views</th>
						<th>Avg. Rating</th>
					</tr>

					<tr>
						<td>
							<%= movie.views %>
						</td>

						<td>
							<% var mean = movie.likes / (movie.likes + movie.dislikes); %>
							<% var scaled = mean * 5; %>

							<%= scaled %> / 5 ‚≠êÔ∏è
						</td>
					</tr>

				</table>
			</div>
		</div>
	</div>
</body>

</html>